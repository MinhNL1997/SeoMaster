<div id="mieruca_optimize">
  <div class="mieruca-optimize-top">
    <button>Save</button>
  </div>
  <div class="mieruca-optimize-editor-text mieruca-optimize-editor">
    <div class="mieruca-optimize-heading">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5956 5.48099C13.8199 5.48099 13.1911 4.86751 13.1911 4.11075V2.8146H9.40444L9.40444 13.1914H10.8089C11.5845 13.1914 12.2133 13.8201 12.2133 14.5957C12.2133 15.3713 11.5845 16 10.8089 16H5.19111C4.41546 16 3.78666 15.3713 3.78666 14.5957C3.78666 13.8201 4.41546 13.1914 5.19111 13.1914H6.59555L6.59555 2.8146H2.80889V4.11075C2.80889 4.86751 2.1801 5.48099 1.40444 5.48099C0.628791 5.48099 0 4.86751 0 4.11075V1.40807V1.37025C0 0.980846 0.166486 0.629383 0.4338 0.379917C0.668567 0.154132 0.980734 0.0126121 1.32485 0.00216367C1.35119 0.000727626 1.37773 -1.16727e-09 1.40444 0C1.42698 9.84586e-10 1.44939 0.00051782 1.47167 0.00154193H14.5283C14.5506 0.000517818 14.573 -9.84583e-10 14.5956 0C14.6223 1.16728e-09 14.6488 0.000727541 14.6751 0.00216342C15.0193 0.0126116 15.3315 0.154177 15.5663 0.380029C15.8336 0.629488 16 0.980905 16 1.37025V1.4049L16 1.40807L16 1.41124V4.11075C16 4.86751 15.3712 5.48099 14.5956 5.48099Z" fill="#667075"/></svg>
      Edit text
    </div>
    <div class="mieruca-optimize-content">
      <textarea name="" id="mieruca_optimize_textarea"></textarea>
    </div>
    <div class="mieruca-optimize-footer">
      <button id='mieruca_optimize_btn_save'>Save</button>
    </div>
  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var textarea = document.getElementById('mieruca_optimize_textarea');
    var mierucaDiv = document.querySelector('.mieruca-optimize-editor');
    var saveButton = document.getElementById('mieruca_optimize_btn_save');
    if (textarea && mierucaDiv) {
      let xpath;
      document.body.addEventListener('click', function(event) {
        if (event.target.id === 'mieruca_optimize_textarea') {
          return;
        }
        var text = event.target.textContent || event.target.innerText;
        xpath = getXPath(event.target);
        if (text) {
          textarea.value = '';
          textarea.value += text;
          mierucaDiv.classList.add('active');
        }
      });
      saveButton.addEventListener('click', function() {
        const newText = textarea.value;
        const elementToReplace = getElementByXPath(xpath);
        if (elementToReplace) {
          elementToReplace.textContent = newText;
        } else {
          console.log('Element not found for XPath:', xpath);
        }
        event.stopPropagation();
        mierucaDiv.classList.remove('active');
      });
    }
  });
  function getXPath(element) {
    if (element.id !== "") {
      return `//*[@id="${element.id}"]`;
    }
    if (element === document.body) {
      return '/html/body';
    }

    let ix = 0;
    const siblings = element.parentNode.childNodes;
    for (let i = 0; i < siblings.length; i++) {
      const sibling = siblings[i];
      if (sibling === element) {
        return getXPath(element.parentNode) + '/' + element.tagName.toLowerCase() + '[' + (ix + 1) + ']';
      }
      if (sibling.nodeType === 1 && sibling.tagName === element.tagName) {
        ix++;
      }
    }
  };
  function getElementByXPath(xpath) {
    return document.evaluate(xpath, document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
  };
</script>
<style>
  .mieruca-optimize-top {
    position: fixed;
    z-index: 99999999;
    top: 0;
    left: 0;
    width: 100%;
    background: #F7F9FA;
    padding: 8px 120px;
  }

  .mieruca-optimize-top button {
    background: #4B4BFA;
    color: #FFFFFF;
    font-size: 14px;
    font-weight: 600;
    line-height: 21px;
    text-align: center;
    border-radius: 4px;
    padding: 5px 16px 5px 16px;
  }
  .mieruca-optimize-editor {
    position: fixed;
    top: 100px;
    right: 100px;
    z-index: 9999;
    background: #F7F9FA;
    box-shadow: 0px 0px 10px 0px #00000040;
    border-radius: 8px;
    display: none;
  }
  .mieruca-optimize-editor.active {
    display: block;
  }

  .mieruca-optimize-heading {
    padding: 8px 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    background: #E1E9ED;
    color: #667075;
  }

  .mieruca-optimize-content {
    padding: 24px;
  }

  .mieruca-optimize-content textarea {
    background: #E9F1F5;
    border-radius: 4px;
    padding: 12px 16px;
    font-size: 13px;
    height: 88px;
    min-width: 275px;
  }

  .mieruca-optimize-footer {
    margin-bottom: 24px;
    text-align: center;
  }
  .mieruca-optimize-footer button {
    background: #FCD4BB;
    color: #4A4A4A;
    font-size: 14px;
    font-weight: 600;
    line-height: 21px;
    text-align: center;
    border-radius: 4px;
    padding: 5px 16px 5px 16px;
  }
</style>